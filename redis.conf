# Redis Configuration File
# Generated for MTAA-DAO Application
# Production-ready with persistence, security, and monitoring

################################## NETWORK #####################################

# Accept connections only from localhost (change if remote access needed)
bind 127.0.0.1 ::1

# Accept connections on port 6379 (default)
port 6379

# TCP listen() backlog
tcp-backlog 511

# Close the connection after a client is idle for N seconds
timeout 0

# TCP keepalive
tcp-keepalive 300

################################# GENERAL #######################################

# Run in background (change to 'no' for Docker/foreground)
daemonize no

# Set server verbosity to 'debug', 'verbose', 'notice', or 'warning' (default: 'notice')
loglevel notice

# Specify the log file name
logfile ""

# Set the number of databases
databases 16

################################ SNAPSHOTTING  ################################

# Save the DB on disk:
# save <seconds> <changes>
# Will save the DB if both the given number of seconds and the given number of write operations
# against the DB occurred.

# Save snapshots every 60 seconds if at least 10,000 keys changed
save 60 10000

# Alternative configurations:
# save 900 1      # Save after 900 sec (15 min) if at least 1 key changed
# save 300 10     # Save after 300 sec (5 min) if at least 10 keys changed
# save 60 10000   # Save after 60 sec if at least 10,000 keys changed

# Disable saving completely (if using AOF only)
# save ""

# Compress string objects using LZ4 when dump.rdb files are created
rdbcompression yes

# Checksum RDB file
rdbchecksum yes

# Filename for the RDB (Redis Database) file
dbfilename dump.rdb

# The working directory
# The DB will be written inside this directory, with the filename specified above using the 'dbfilename' configuration directive
dir ./

################################# REPLICATION #################################

# Master/Replica replication
# replica-read-only yes
# replica-serve-stale-data yes

################################## SECURITY ###################################

# CRITICAL: Set a password for Redis
# requirepass <password>
requirepass "@billionaremindset001"

# ACL configuration (Redis 6.0+)
# aclfile /path/to/aclfile

# ACL DENYLIST (recommended for production)
# aclcat-denylist @admin

################################### CLIENTS ####################################

# Set the max number of connected clients
# maxclients 10000

############################## MEMORY MANAGEMENT ###############################

# Set a memory usage limit
# maxmemory <bytes>
# maxmemory 256mb

# Memory eviction policy when maxmemory is reached
# maxmemory-policy noeviction
# Options: volatile-lru, allkeys-lru, volatile-lfu, allkeys-lfu, volatile-random, allkeys-random, volatile-ttl, noeviction

############################# LAZY FREEING ####################################

# Lazy eviction of keys
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
lazyfree-lazy-user-del no

############################ KERNEL OOM CONTROL ##############################

# oom-score-adj: Adjust the score Linux uses to select processes for OOM kill
# oom-score-adj no

###################### KERNEL TRANSPARENT HUGEPAGE ###########################

# disable-thp yes

############################## AOF (Append Only File) #############################

# Enable the AOF (Append Only File) persistence mode
# This logs every write operation received by the server
# More durable than RDB alone
appendonly yes

# AOF filename
appendfilename "appendonly.aof"

# AOF fsync policy:
# appendfsync always     # Fsync every write (safer but slower)
# appendfsync everysec   # Fsync every second (recommended - good balance)
# appendfsync no         # Let the OS decide (fastest but less safe)
appendfsync everysec

# When the AOF fsync policy is set to "always" or "everysec", and background
# saving is in progress, the main process is blocked from trying to execute
# write commands, because fsyncing in the main process may block the server
# from executing its duties with the client.
no-appendfsync-on-rewrite no

# Automatic AOF rewrite when AOF gets too large
# Redis will automatically compact the AOF
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# AOF rewrite when percentage of the original size is exceeded
aof-rewrite-incremental-fsync yes

# Load Redis from the AOF file on startup
aof-load-truncated yes

################################ LUA SCRIPTING  ###############################

# Max execution time for Lua scripts (milliseconds)
lua-time-limit 5000

################################ REDIS CLUSTER  ###############################

# cluster-enabled no

################################## SLOW LOG ###################################

# Log queries slower than specified microseconds
slowlog-log-slower-than 10000

# Log up to this many queries
slowlog-max-len 128

################################ LATENCY MONITOR ##############################

latency-monitor-threshold 0

############################# EVENT NOTIFICATION ##############################

# Enable keyspace notifications for debugging
# Examples: "AKE" for all events
notify-keyspace-events ""

############################### ADVANCED CONFIG ###############################

# Hash table settings
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List settings
list-max-ziplist-size -2
list-compress-depth 0

# Set settings
set-max-intset-entries 512

# Sorted set settings
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog
hll-sparse-max-bytes 3000

# Stream settings
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active rehashing
activerehashing yes

# Client output buffer limits
# <class> <hard limit> <soft limit> <soft seconds>
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Protocol buffer limit
# protocol-buffer-limit 1gb

# Frequency of active defragmentation
# active-defrag-threshold-lower 10
# active-defrag-threshold-upper 100

# Minimum percentage of fragmentation to start active defragmentation
# active-defrag-ignore-bytes 100mb
# active-defrag-ignore-keys 10000

# Jemalloc background thread for purging
jemalloc-bg-thread yes

################################## MODULES ######################################

# loadmodule /path/to/module.so

################################## KERNEL OOM ###################################

# oom-score-adj no

################################ SENTINEL ######################################

# Sentinel configuration would go here

################################## FINAL NOTES #################################

# This configuration is optimized for:
# 1. Persistence: Both RDB snapshots and AOF logging enabled
# 2. Security: Password authentication required
# 3. Performance: Reasonable defaults for most applications
# 4. Monitoring: Slow log and latency monitoring enabled
#
# For production:
# - Change "requirepass yourpassword" to a strong password
# - Monitor memory usage with "maxmemory"
# - Adjust save intervals based on your needs
# - Use firewall rules to restrict access
# - Enable AOF for higher durability
# - Monitor with redis-cli INFO and slowlog
